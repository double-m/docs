## A Web CRUD with Symfony and Doctrine

### Let's create a todo-list from scratch, with a web UI and a RDBMS as backend

MySQL database

```
$ mysql -u root # use -p if the password is needed
  DROP DATABASE IF EXISTS `todolist`;
  DROP USER 'todolist'@'localhost';
  CREATE USER 'todolist'@'localhost' IDENTIFIED BY 'todolist';
  CREATE DATABASE `todolist`;
  GRANT ALL PRIVILEGES ON `todolist`.* TO 'todolist'@'localhost';
```

A new Symfony installation

```
$ symfony new my_todolist 2.8

cd my_todolist

$ rm -rf app/cache/*
  rm -rf app/logs/*
  HTTPDUSER=www-data
  sudo setfacl -R -m u:"$HTTPDUSER":rwX -m u:`whoami`:rwX app/cache app/logs
  sudo setfacl -dR -m u:"$HTTPDUSER":rwX -m u:`whoami`:rwX app/cache app/logs
```

We can see the default application running pointing the web browser to `localhost:8000` after typing

```
$ php app/console server:run
```

Change the Symfony configuration to access the databases

```
$ vi app/config/parameters.yml # use value 'todolist' for 'database_name', 'satabase_user', 'database_password'
  php app/console doctrine:database:drop --force
  php app/console doctrine:database:create
```

A new Bundle (TodoBundle) with a single Entity (Todo)

```
$ php app/console generate:bundle -n --namespace=TodoBundle --format=yml
  php app/console doctrine:generate:entity --entity=TodoBundle:Todo --format=yml
```

Generate the CRUD (the model, the views and the controller's actions)

```
$ php app/console generate:doctrine:crud --entity=TodoBundle:Todo --format=yml --with-write --no-interaction --overwrite
```

Create the database schema

```
$ php app/console doctrine:schema:create
```

Enable the autogenerated E2E tests for the CRUD

```
$ rm src/*/Tests/Controller/DefaultControllerTest.php
  vi src/TodoBundle/Tests/Controller/TodoControllerTest.php
  # change todolist_todo[fieldname] -> todo[title]
  # change the button value Update -> Edit
  # the default title's value "Test" doesn't work: use smething else, like "Bar"
  phpunit -c app
```
